<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ìì„±í–¥ ë§ì¶¤í˜• ì„œë¹„ìŠ¤ - ì¹´ì¹´ì˜¤í˜ì´ì¦ê¶Œ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --kakao-yellow: #FEE500;
            --kakao-black: #3C1E1E;
            --kakao-gray-100: #F2F3F5;
            --kakao-gray-200: #E5E8EB;
            --kakao-gray-300: #D1D6DB;
            --kakao-gray-400: #9AA1A9;
            --kakao-gray-500: #737B84;
            --kakao-gray-600: #4E5968;
            --kakao-gray-700: #333D4B;
            --kakao-gray-800: #191F28;
            --kakao-blue: #4285F4;
            --kakao-green: #00C851;
            --kakao-red: #FF4444;
            --gradient-primary: linear-gradient(135deg, #FEE500 0%, #FFD700 100%);
            --gradient-card: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            --gradient-dark: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--kakao-gray-100);
            color: var(--kakao-gray-800);
            line-height: 1.6;
        }

        .header {
            background: var(--gradient-primary);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header h1 {
            color: var(--kakao-black);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--kakao-black);
        }

        .profile-info h3 {
            color: var(--kakao-black);
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .profile-info p {
            color: var(--kakao-gray-700);
            font-size: 0.8rem;
        }

        .mbti-badge {
            background: var(--kakao-gray-800);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--kakao-gray-200);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--kakao-gray-200);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--kakao-gray-800);
        }

        .button {
            background: var(--gradient-primary);
            color: var(--kakao-black);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(254, 229, 0, 0.3);
        }

        .button.secondary {
            background: white;
            color: var(--kakao-gray-700);
            border: 2px solid var(--kakao-gray-300);
        }

        .button.secondary:hover {
            background: var(--kakao-gray-100);
        }

        .user-selector {
            margin-bottom: 2rem;
        }

        .user-selector select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--kakao-gray-300);
            border-radius: 12px;
            font-size: 1rem;
            background: white;
        }

        .investment-type-card {
            background: var(--gradient-card);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            border: 2px solid var(--kakao-yellow);
            margin-bottom: 2rem;
        }

        .investment-type-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .investment-type-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--kakao-gray-800);
            margin-bottom: 0.5rem;
        }

        .investment-type-description {
            color: var(--kakao-gray-600);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }

        .confidence-score {
            background: var(--kakao-gray-100);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            display: inline-block;
            font-weight: 600;
            color: var(--kakao-gray-700);
        }

        .mbti-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .mbti-modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .mbti-step {
            display: none;
        }

        .mbti-step.active {
            display: block;
        }

        .question-card {
            background: var(--kakao-gray-100);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .question-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--kakao-gray-800);
        }

        .option-button {
            background: white;
            border: 2px solid var(--kakao-gray-300);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
        }

        .option-button:hover {
            border-color: var(--kakao-yellow);
            background: #fff9e6;
        }

        .option-button.selected {
            border-color: var(--kakao-yellow);
            background: var(--gradient-primary);
            color: var(--kakao-black);
        }

        .progress-bar {
            background: var(--kakao-gray-200);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 1rem;
        }

        .progress-fill {
            background: var(--gradient-primary);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .recommendation-card {
            background: var(--kakao-gray-100);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .recommendation-card h4 {
            color: var(--kakao-gray-800);
            margin-bottom: 0.5rem;
        }

        .recommendation-card p {
            color: var(--kakao-gray-600);
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--kakao-gray-500);
        }

        .error {
            background: #ffebee;
            color: var(--kakao-red);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--kakao-red);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .profile-section {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================= API Service =========================
        class InvestmentProfileService {
            constructor() {
                this.baseURL = 'http://localhost:5001/api';
            }

            async request(endpoint, options = {}) {
                try {
                    console.log(`API ìš”ì²­: ${this.baseURL}${endpoint}`);
                    const response = await fetch(`${this.baseURL}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });
                    
                    console.log(`API ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('API ì‘ë‹µ ë°ì´í„°:', data);
                    return data;
                } catch (error) {
                    console.error('API request failed:', error);
                    throw error;
                }
            }

            async getUsers() {
                return this.request('/users');
            }

            async getUser(userId) {
                return this.request(`/users/${userId}`);
            }

            async getUserBehaviors(userId, days = 90) {
                return this.request(`/users/${userId}/behaviors?days=${days}`);
            }

            async getUserTrades(userId, limit = 100) {
                return this.request(`/users/${userId}/trades?limit=${limit}`);
            }

            async getUserWatchlist(userId) {
                return this.request(`/users/${userId}/watchlist`);
            }

            async getMBTIRecommendation(userId) {
                return this.request(`/users/${userId}/mbti-recommendation`);
            }

            async getMBTIAnalysis(userId) {
                return this.request(`/users/${userId}/mbti-analysis`);
            }

            async getMBTIQuestionnaire() {
                return this.request('/mbti/questionnaire');
            }

            async calculateMBTIFromQuestionnaire(answers) {
                return this.request('/mbti/calculate', {
                    method: 'POST',
                    body: JSON.stringify({ answers })
                });
            }
        }

        // ========================= Investment Types =========================
        const INVESTMENT_TYPES = {
            growth: {
                name: "ë¶ˆê½ƒ í˜¸ë‘ì´",
                icon: "ğŸ”¥",
                description: "ëœ¨ê±°ìš´ ì„±ì¥ì£¼ì— ì˜¬ì¸í•˜ëŠ” ëª¨í—˜ê°€í˜•",
                characteristics: ["ë†’ì€ ìˆ˜ìµ ì¶”êµ¬", "ë‹¨ê¸° ë³€ë™ì„± ê°ìˆ˜", "ì„±ì¥ì£¼ ì„ í˜¸", "ëª¨ë©˜í…€ íˆ¬ì"],
                recommendations: {
                    stocks: ["ì‚¼ì„±ì „ì", "SKí•˜ì´ë‹‰ìŠ¤", "NAVER", "ì¹´ì¹´ì˜¤"],
                    sectors: ["ê¸°ìˆ ", "ë°˜ë„ì²´", "ë°”ì´ì˜¤", "2ì°¨ì „ì§€"],
                    strategies: ["ëª¨ë©˜í…€ íˆ¬ì", "ì„¹í„° ë¡œí…Œì´ì…˜", "ì„±ì¥ì£¼ ì§‘ì¤‘"]
                }
            },
            dividend: {
                name: "ë“ ë“  ì˜¬ë¹¼ë¯¸",
                icon: "ğŸ¦‰",
                description: "ë°°ë‹¹ìœ¼ë¡œ ë§¤ë‹¬ ìš©ëˆ ë°›ëŠ” ì•ˆì •í˜•",
                characteristics: ["ì•ˆì •ì  ìˆ˜ìµ", "ë°°ë‹¹ ìˆ˜ìµ ì¤‘ì‹œ", "ë¦¬ìŠ¤í¬ íšŒí”¼", "ì¥ê¸° íˆ¬ì"],
                recommendations: {
                    stocks: ["í•œêµ­ì „ë ¥", "KT&G", "ì‹ ì„¸ê³„", "POSCO"],
                    sectors: ["ìœ í‹¸ë¦¬í‹°", "í†µì‹ ", "ì†Œë¹„ì¬", "ê¸ˆìœµ"],
                    strategies: ["ë°°ë‹¹ì£¼ íˆ¬ì", "ì•ˆì •ì„± ì¤‘ì‹œ", "ì¥ê¸° ë³´ìœ "]
                }
            },
            index: {
                name: "ê±°ë¶ì´ í”Œëœ",
                icon: "ğŸ¢",
                description: "ETF ì ë¦½ìœ¼ë¡œ ëŠê¸‹í•˜ê²Œ ì¥ê¸°íˆ¬ì",
                characteristics: ["ë¶„ì‚°íˆ¬ì", "ì €ë¹„ìš©", "ì¥ê¸° íˆ¬ì", "ì•ˆì •ì„±"],
                recommendations: {
                    stocks: ["TIGER 200", "ARIRANG 200", "KODEX 200", "ACE 200"],
                    sectors: ["ì§€ìˆ˜ ETF", "ì„¹í„° ETF", "í•´ì™¸ ETF"],
                    strategies: ["ì •ê¸° ì ë¦½", "ë¦¬ë°¸ëŸ°ì‹±", "ë¶„ì‚°íˆ¬ì"]
                }
            },
            value: {
                name: "ê°€ì¹˜ ì—¬ìš°",
                icon: "ğŸ¦Š",
                description: "ìˆ¨ì€ ë³´ì„ ì°¾ì•„ ëª¨ìœ¼ëŠ” ì €í‰ê°€ í—Œí„°",
                characteristics: ["ì €í‰ê°€ ì¢…ëª© ë°œêµ´", "ë°¸ë¥˜ íˆ¬ì", "ì¥ê¸° ê´€ì ", "ì•ˆì „ë§ˆì§„"],
                recommendations: {
                    stocks: ["í˜„ëŒ€ì°¨", "ê¸°ì•„", "LGí™”í•™", "SKí…”ë ˆì½¤"],
                    sectors: ["ìë™ì°¨", "í™”í•™", "í†µì‹ ", "ê¸ˆìœµ"],
                    strategies: ["ë°¸ë¥˜ íˆ¬ì", "ì €í‰ê°€ ë°œêµ´", "ì•ˆì „ë§ˆì§„ í™•ë³´"]
                }
            },
            quant: {
                name: "ë£° ê¸°ë°˜ ê¹Œë§ˆê·€",
                icon: "ğŸ¦â€â¬›",
                description: "ë°ì´í„°ì™€ ê·œì¹™ìœ¼ë¡œë§Œ íŒë‹¨í•˜ëŠ” ì´ì„±í˜•",
                characteristics: ["ì •ëŸ‰ì  ë¶„ì„", "ë°±í…ŒìŠ¤íŠ¸", "íŒ©í„° íˆ¬ì", "ê°ì • ë°°ì œ"],
                recommendations: {
                    stocks: ["íŒ©í„° ETF", "í€„ë¦¬í‹° ETF", "ëª¨ë©˜í…€ ETF"],
                    sectors: ["íŒ©í„° ê¸°ë°˜", "í€„ë¦¬í‹°", "ëª¨ë©˜í…€", "ê°€ì¹˜"],
                    strategies: ["íŒ©í„° íˆ¬ì", "ë°±í…ŒìŠ¤íŠ¸", "ì •ëŸ‰ì  ë¶„ì„"]
                }
            },
            esg: {
                name: "ì´ˆë¡ ì‚¬ìŠ´",
                icon: "ğŸ¦Œ",
                description: "í™˜ê²½Â·ì‚¬íšŒë„ ì±™ê¸°ëŠ” ì°©í•œ íˆ¬ì",
                characteristics: ["ESG ì¤‘ì‹œ", "ì§€ì†ê°€ëŠ¥ì„±", "ì‚¬íšŒì  ê°€ì¹˜", "ì¥ê¸° ê´€ì "],
                recommendations: {
                    stocks: ["ESG ETF", "ì¹œí™˜ê²½ ê¸°ì—…", "ì‚¬íšŒì  ê¸°ì—…"],
                    sectors: ["ì¹œí™˜ê²½", "ì‹ ì¬ìƒì—ë„ˆì§€", "ESG"],
                    strategies: ["ESG íˆ¬ì", "ì„íŒ©íŠ¸ íˆ¬ì", "ì§€ì†ê°€ëŠ¥ íˆ¬ì"]
                }
            }
        };

        // ========================= Components =========================
        function UserSelector({ users, selectedUser, onUserChange, loading }) {
            if (loading) {
                return (
                    <div className="user-selector">
                        <div className="loading">ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                );
            }

            return (
                <div className="user-selector">
                    <select value={selectedUser || ''} onChange={(e) => onUserChange(e.target.value)}>
                        <option value="">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        {users.map(user => (
                            <option key={user.user_id} value={user.user_id}>
                                {user.name} ({user.user_id})
                            </option>
                        ))}
                    </select>
                </div>
            );
        }

        function ProfileHeader({ user, investmentType, onStartMBTI }) {
            if (!user) {
                return (
                    <div className="profile-section">
                        <div className="profile-avatar">ğŸ‘¤</div>
                        <div className="profile-info">
                            <h3>ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                            <p>íˆ¬ìì„±í–¥ì„ í™•ì¸í•˜ë ¤ë©´ ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                );
            }

            const typeInfo = investmentType ? INVESTMENT_TYPES[investmentType] : null;

            return (
                <div className="profile-section">
                    <div className="profile-avatar">
                        {typeInfo ? typeInfo.icon : 'ğŸ‘¤'}
                    </div>
                    <div className="profile-info">
                        <h3>{user.name}</h3>
                        <p>{user.age}ì„¸ â€¢ {user.gender} â€¢ {user.occupation}</p>
                        {typeInfo && (
                            <div className="mbti-badge">
                                {typeInfo.name}
                            </div>
                        )}
                    </div>
                    <button className="button" onClick={onStartMBTI}>
                        ğŸ¯ íˆ¬ìì„±í–¥ ì§„ë‹¨
                    </button>
                </div>
            );
        }

        function InvestmentTypeCard({ investmentType, confidence }) {
            if (!investmentType) {
                return (
                    <div className="card">
                        <h2>íˆ¬ìì„±í–¥ì„ ì§„ë‹¨í•´ë³´ì„¸ìš”</h2>
                        <p>ë‹¹ì‹ ì˜ íˆ¬ì íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ë§ì¶¤í˜• íˆ¬ì ì„±í–¥ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.</p>
                    </div>
                );
            }

            const typeInfo = INVESTMENT_TYPES[investmentType];

            return (
                <div className="investment-type-card">
                    <div className="investment-type-icon">{typeInfo.icon}</div>
                    <div className="investment-type-name">{typeInfo.name}</div>
                    <div className="investment-type-description">{typeInfo.description}</div>
                    <div className="confidence-score">
                        ì‹ ë¢°ë„: {Math.round(confidence * 100)}%
                    </div>
                </div>
            );
        }

        function MBTIModal({ isOpen, onClose, onComplete, userData }) {
            const [currentStep, setCurrentStep] = useState(0);
            const [answers, setAnswers] = useState({});
            const [dataRecommendation, setDataRecommendation] = useState(null);
            const [loading, setLoading] = useState(false);

            const questions = [
                {
                    id: "risk",
                    question: "ë‹¨ê¸° ë³€ë™ì„±ì„ ê°ìˆ˜í•˜ë”ë¼ë„ ë†’ì€ ìˆ˜ìµì„ ë…¸ë¦°ë‹¤.",
                    options: [
                        { label: "ë§¤ìš° ê·¸ë ‡ë‹¤", value: "high" },
                        { label: "ë³´í†µ", value: "medium" },
                        { label: "ì•„ë‹ˆë‹¤", value: "low" }
                    ]
                },
                {
                    id: "horizon",
                    question: "ë‚˜ì˜ íˆ¬ì ê¸°ê°„ì€?",
                    options: [
                        { label: "1~3ë…„", value: "short" },
                        { label: "3~7ë…„", value: "medium" },
                        { label: "7ë…„+", value: "long" }
                    ]
                },
                {
                    id: "strategy",
                    question: "ì–´ë–¤ íˆ¬ì ì „ëµì„ ì„ í˜¸í•˜ë‚˜ìš”?",
                    options: [
                        { label: "ì„±ì¥ì£¼ ì¤‘ì‹¬", value: "growth" },
                        { label: "ë°°ë‹¹ì£¼ ì¤‘ì‹¬", value: "dividend" },
                        { label: "ETF ë¶„ì‚°íˆ¬ì", value: "index" },
                        { label: "ì €í‰ê°€ ì¢…ëª© ë°œêµ´", value: "value" }
                    ]
                },
                {
                    id: "analysis",
                    question: "íˆ¬ì ê²°ì • ì‹œ ê°€ì¥ ì¤‘ì‹œí•˜ëŠ” ê²ƒì€?",
                    options: [
                        { label: "ê¸°ìˆ ì  ë¶„ì„", value: "technical" },
                        { label: "ê¸°ë³¸ì  ë¶„ì„", value: "fundamental" },
                        { label: "ë°ì´í„° ë¶„ì„", value: "quantitative" },
                        { label: "ESG ì§€í‘œ", value: "esg" }
                    ]
                },
                {
                    id: "frequency",
                    question: "ê±°ë˜ ë¹ˆë„ëŠ”?",
                    options: [
                        { label: "ë§¤ì¼", value: "daily" },
                        { label: "ì£¼ 1-2íšŒ", value: "weekly" },
                        { label: "ì›” 1-2íšŒ", value: "monthly" },
                        { label: "ë¶„ê¸° 1íšŒ", value: "quarterly" }
                    ]
                }
            ];

            useEffect(() => {
                if (isOpen && userData) {
                    loadDataRecommendation();
                }
            }, [isOpen, userData]);

            const loadDataRecommendation = async () => {
                if (!userData) return;
                
                setLoading(true);
                try {
                    const service = new InvestmentProfileService();
                    const recommendation = await service.getMBTIRecommendation(userData.user.user_id);
                    setDataRecommendation(recommendation);
                } catch (error) {
                    console.error('ë°ì´í„° ì¶”ì²œ ë¡œë“œ ì‹¤íŒ¨:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleAnswer = (questionId, answer) => {
                setAnswers(prev => ({
                    ...prev,
                    [questionId]: answer
                }));
            };

            const nextStep = () => {
                if (currentStep < questions.length - 1) {
                    setCurrentStep(currentStep + 1);
                } else {
                    calculateFinalResult();
                }
            };

            const calculateFinalResult = () => {
                // ê°„ë‹¨í•œ ì ìˆ˜ ê³„ì‚° ë¡œì§
                const scores = {
                    growth: 0,
                    dividend: 0,
                    index: 0,
                    value: 0,
                    quant: 0,
                    esg: 0
                };

                // ë‹µë³€ì— ë”°ë¥¸ ì ìˆ˜ ê³„ì‚°
                Object.entries(answers).forEach(([questionId, answer]) => {
                    switch (questionId) {
                        case 'risk':
                            if (answer === 'high') scores.growth += 3;
                            else if (answer === 'medium') scores.value += 2;
                            else scores.dividend += 3;
                            break;
                        case 'horizon':
                            if (answer === 'short') scores.growth += 2;
                            else if (answer === 'medium') scores.value += 2;
                            else scores.index += 3;
                            break;
                        case 'strategy':
                            scores[answer] += 3;
                            break;
                        case 'analysis':
                            if (answer === 'technical') scores.growth += 2;
                            else if (answer === 'fundamental') scores.value += 2;
                            else if (answer === 'quantitative') scores.quant += 3;
                            else scores.esg += 3;
                            break;
                        case 'frequency':
                            if (answer === 'daily') scores.growth += 3;
                            else if (answer === 'weekly') scores.value += 2;
                            else if (answer === 'monthly') scores.index += 2;
                            else scores.dividend += 3;
                            break;
                    }
                });

                // ìµœê³  ì ìˆ˜ ìœ í˜• ì°¾ê¸°
                const maxScore = Math.max(...Object.values(scores));
                const recommendedType = Object.keys(scores).find(key => scores[key] === maxScore);
                
                onComplete(recommendedType, maxScore / 15); // ì •ê·œí™”ëœ ì‹ ë¢°ë„
                onClose();
            };

            if (!isOpen) return null;

            return (
                <div className="mbti-modal">
                    <div className="mbti-modal-content">
                        <div className="card-header">
                            <h2>ğŸ¯ íˆ¬ìì„±í–¥ ì§„ë‹¨</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem' }}>âœ•</button>
                        </div>

                        {/* ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ */}
                        {currentStep === 0 && (
                            <div className="mbti-step active">
                                <h3>ğŸ“Š ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ</h3>
                                {loading ? (
                                    <div className="loading">ë¶„ì„ ì¤‘...</div>
                                ) : dataRecommendation ? (
                                    <div>
                                        <p>ë‹¹ì‹ ì˜ ê±°ë˜ íŒ¨í„´ê³¼ í–‰ë™ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼:</p>
                                        <div className="investment-type-card" style={{ margin: '1rem 0' }}>
                                            <div className="investment-type-icon">
                                                {INVESTMENT_TYPES[dataRecommendation.recommended_type]?.icon}
                                            </div>
                                            <div className="investment-type-name">
                                                {INVESTMENT_TYPES[dataRecommendation.recommended_type]?.name}
                                            </div>
                                            <div className="confidence-score">
                                                ì‹ ë¢°ë„: {Math.round(dataRecommendation.confidence * 100)}%
                                            </div>
                                        </div>
                                        <p>ì´ì œ ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µë³€í•˜ì—¬ ë” ì •í™•í•œ ì§„ë‹¨ì„ ë°›ì•„ë³´ì„¸ìš”.</p>
                                    </div>
                                ) : (
                                    <div className="error">ë°ì´í„° ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
                                )}
                                <button className="button" onClick={nextStep}>
                                    ì§ˆë¬¸ ì‹œì‘í•˜ê¸°
                                </button>
                            </div>
                        )}

                        {/* ì§ˆë¬¸ ë‹¨ê³„ */}
                        {currentStep > 0 && currentStep <= questions.length && (
                            <div className="mbti-step active">
                                <div className="progress-bar">
                                    <div 
                                        className="progress-fill" 
                                        style={{ width: `${(currentStep / questions.length) * 100}%` }}
                                    ></div>
                                </div>
                                
                                <div className="question-card">
                                    <div className="question-title">
                                        {currentStep}. {questions[currentStep - 1].question}
                                    </div>
                                    <div>
                                        {questions[currentStep - 1].options.map((option, index) => (
                                            <button
                                                key={index}
                                                className={`option-button ${answers[questions[currentStep - 1].id] === option.value ? 'selected' : ''}`}
                                                onClick={() => handleAnswer(questions[currentStep - 1].id, option.value)}
                                            >
                                                {option.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                    {currentStep > 1 && (
                                        <button 
                                            className="button secondary" 
                                            onClick={() => setCurrentStep(currentStep - 1)}
                                        >
                                            ì´ì „
                                        </button>
                                    )}
                                    <button 
                                        className="button" 
                                        onClick={nextStep}
                                        disabled={!answers[questions[currentStep - 1].id]}
                                    >
                                        {currentStep === questions.length ? 'ì™„ë£Œ' : 'ë‹¤ìŒ'}
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function InvestmentRecommendations({ investmentType }) {
            if (!investmentType) {
                return (
                    <div className="card">
                        <h3>íˆ¬ì ì¶”ì²œ ì •ë³´</h3>
                        <p>íˆ¬ìì„±í–¥ì„ ì§„ë‹¨í•˜ë©´ ë§ì¶¤í˜• íˆ¬ì ì •ë³´ë¥¼ ì œê³µí•´ë“œë¦½ë‹ˆë‹¤.</p>
                    </div>
                );
            }

            const typeInfo = INVESTMENT_TYPES[investmentType];

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">ğŸ¯ {typeInfo.name} ë§ì¶¤ íˆ¬ì ì •ë³´</h3>
                    </div>
                    
                    <div className="recommendation-grid">
                        <div className="recommendation-card">
                            <h4>ğŸ“ˆ ì¶”ì²œ ì¢…ëª©</h4>
                            <p>{typeInfo.recommendations.stocks.join(', ')}</p>
                        </div>
                        
                        <div className="recommendation-card">
                            <h4>ğŸ¢ ê´€ì‹¬ ì„¹í„°</h4>
                            <p>{typeInfo.recommendations.sectors.join(', ')}</p>
                        </div>
                        
                        <div className="recommendation-card">
                            <h4>ğŸ’¡ íˆ¬ì ì „ëµ</h4>
                            <p>{typeInfo.recommendations.strategies.join(', ')}</p>
                        </div>
                        
                        <div className="recommendation-card">
                            <h4>ğŸ¯ íˆ¬ì íŠ¹ì§•</h4>
                            <p>{typeInfo.characteristics.join(', ')}</p>
                        </div>
                    </div>
                </div>
            );
        }

        // ========================= Main App =========================
        function InvestmentProfileApp() {
            const [users, setUsers] = useState([]);
            const [selectedUser, setSelectedUser] = useState(null);
            const [userData, setUserData] = useState(null);
            const [investmentType, setInvestmentType] = useState(null);
            const [confidence, setConfidence] = useState(0);
            const [mbtiModalOpen, setMbtiModalOpen] = useState(false);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                loadUsers();
            }, []);

            useEffect(() => {
                if (selectedUser) {
                    loadUserData(selectedUser);
                }
            }, [selectedUser]);

            const loadUsers = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    console.log('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹œì‘');
                    
                    const service = new InvestmentProfileService();
                    const usersData = await service.getUsers();
                    
                    console.log('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì„±ê³µ:', usersData);
                    setUsers(usersData);
                } catch (error) {
                    console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    setError(`ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const loadUserData = async (userId) => {
                try {
                    setLoading(true);
                    setError(null);
                    console.log('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹œì‘:', userId);
                    
                    const service = new InvestmentProfileService();
                    const [user, behaviors, trades, watchlist] = await Promise.all([
                        service.getUser(userId),
                        service.getUserBehaviors(userId),
                        service.getUserTrades(userId),
                        service.getUserWatchlist(userId)
                    ]);

                    console.log('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì„±ê³µ:', { user, behaviors, trades, watchlist });
                    setUserData({
                        user,
                        behaviors,
                        trades,
                        watchlist
                    });

                    // ê¸°ì¡´ íˆ¬ìì„±í–¥ ë¡œë“œ ì‹œë„
                    try {
                        const recommendation = await service.getMBTIRecommendation(userId);
                        setInvestmentType(recommendation.recommended_type);
                        setConfidence(recommendation.confidence);
                    } catch (error) {
                        console.log('ê¸°ì¡´ íˆ¬ìì„±í–¥ ì—†ìŒ:', error.message);
                    }
                } catch (error) {
                    console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    setError(`ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const handleMBTIComplete = (type, conf) => {
                setInvestmentType(type);
                setConfidence(conf);
            };

            return (
                <div>
                    <header className="header">
                        <div className="header-content">
                            <h1>ğŸ¦ ì¹´ì¹´ì˜¤í˜ì´ì¦ê¶Œ</h1>
                            <ProfileHeader 
                                user={userData?.user} 
                                investmentType={investmentType}
                                onStartMBTI={() => setMbtiModalOpen(true)}
                            />
                        </div>
                    </header>

                    <div className="container">
                        {error && (
                            <div className="error">
                                <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                                <p>{error}</p>
                                <button className="button" onClick={() => setError(null)}>
                                    ì˜¤ë¥˜ ë‹«ê¸°
                                </button>
                            </div>
                        )}

                        <UserSelector 
                            users={users}
                            selectedUser={selectedUser}
                            onUserChange={setSelectedUser}
                            loading={loading}
                        />

                        {userData && (
                            <>
                                <InvestmentTypeCard 
                                    investmentType={investmentType}
                                    confidence={confidence}
                                />

                                <InvestmentRecommendations 
                                    investmentType={investmentType}
                                />
                            </>
                        )}

                        <MBTIModal
                            isOpen={mbtiModalOpen}
                            onClose={() => setMbtiModalOpen(false)}
                            onComplete={handleMBTIComplete}
                            userData={userData}
                        />
                    </div>
                </div>
            );
        }

        // ========================= Render =========================
        console.log('React ì•± ì‹œì‘');
        try {
            ReactDOM.render(<InvestmentProfileApp />, document.getElementById('root'));
            console.log('React ì•± ë Œë”ë§ ì™„ë£Œ');
        } catch (error) {
            console.error('React ì•± ë Œë”ë§ ì‹¤íŒ¨:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 2rem; text-align: center;">
                    <h2>âŒ ì•± ë¡œë“œ ì‹¤íŒ¨</h2>
                    <p>${error.message}</p>
                    <p>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                </div>
            `;
        }
    </script>
</body>
</html>
